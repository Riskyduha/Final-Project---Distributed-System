<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event-Driven Chat Simulation</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" integrity="" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h2>ğŸš€ Event-Driven Chat Simulation (2 Nodes)</h2>
    
    <!-- Control Panel -->
    <div class="control-panel">
      <label>Instance Node ID:</label>
      <select id="nodeSelect">
        <option value="A">Node A</option>
        <option value="B">Node B</option>
      </select>
      <button id="registerBtn">ğŸ”— Register</button>
      
      <label style="margin-left: 20px">Delivery Method:</label>
      <select id="methodSelect">
        <option value="Direct">âš¡ Direct</option>
        <option value="PubSub">ğŸ“¡ PubSub (ACK+Resend)</option>
      </select>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
      <!-- Left Panel - Chat Nodes -->
      <div class="panel">
        <!-- Node A -->
        <div class="card node-a">
          <strong>ğŸ’¬ Node A</strong>
          <div id="panelA" class="log"></div>
          <div class="input-section">
            <input id="msgA" placeholder="Type message from Node A..." />
            <button onclick="sendFrom('A')">Send to B â†’</button>
          </div>
        </div>
        
        <!-- Node B -->
        <div class="card node-b">
          <strong>ğŸ’¬ Node B</strong>
          <div id="panelB" class="log"></div>
          <div class="input-section">
            <input id="msgB" placeholder="Type message from Node B..." />
            <button onclick="sendFrom('B')">Send to A â†’</button>
          </div>
        </div>
      </div>

      <!-- Right Panel - Monitoring & Config -->
      <div class="panel">
        <!-- Metrics -->
        <div class="card">
          <strong>ğŸ“Š Metrics / Monitor</strong>
          <div id="metrics" class="metrics">
            <div class="loading">Waiting for data...</div>
          </div>
        </div>
        
        <!-- Configuration -->
        <div class="card">
          <strong>âš™ï¸ Simulation Config</strong>
          <div class="config-row">
            <label>Loss Rate (%):</label>
            <input id="lossRate" type="number" min="0" max="100" value="10"/>
          </div>
          <div class="config-row">
            <label>Latency Min (ms):</label>
            <input id="latencyMin" type="number" min="0" value="50"/>
          </div>
          <div class="config-row">
            <label>Latency Max (ms):</label>
            <input id="latencyMax" type="number" min="0" value="250"/>
          </div>
          <div class="config-row">
            <label>Max Retries:</label>
            <input id="maxRetries" type="number" min="0" value="2"/>
          </div>
          <div class="config-row">
            <label>ACK Timeout (ms):</label>
            <input id="ackTimeout" type="number" min="100" value="600"/>
          </div>
          <button id="updateConfigBtn">ğŸ”„ Update Config</button>
        </div>
        
        <!-- Event Log -->
        <div class="card">
          <strong>ğŸ“ Event Log</strong>
          <div id="eventLog" class="log"></div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-container">
      <div class="chart-card">
        <strong>â±ï¸ Latency (avg)</strong>
        <canvas id="latencyChart"></canvas>
      </div>
      <div class="chart-card">
        <strong>ğŸ“ˆ Throughput (delivered/s)</strong>
        <canvas id="throughputChart"></canvas>
      </div>
    </div>
  </div>

  <script src="/static/js/app.js"></script>
</body>
</html>